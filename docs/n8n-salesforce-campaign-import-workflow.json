{
  "name": "Salesforce Campaign Import",
  "id": "YNsWb78hzRAhDWLR",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "salesforce-campaign-import",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-campaign-import",
      "name": "Webhook: Campaign Import",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [250, 300],
      "webhookId": "salesforce-campaign-import",
      "description": "POST from Lovable app via import-salesforce-campaign edge function. Body: { campaign_id, user_id, salesforce_campaign_id }"
    },
    {
      "parameters": {
        "resource": "campaignMember",
        "operation": "query",
        "soql": "=SELECT Id, ContactId, Status, Prospecting_Status__c, Account.Id, Account.Name, Account.Website FROM CampaignMember WHERE CampaignId = '{{ $json.body.salesforce_campaign_id }}' AND Prospecting_Status__c = 'Target Account'",
        "options": {}
      },
      "id": "salesforce-query",
      "name": "Salesforce: Query Target Accounts",
      "type": "n8n-nodes-base.salesforce",
      "typeVersion": 2,
      "position": [550, 300],
      "credentials": {
        "salesforceOAuth2Api": {
          "id": "Salesforce account 3",
          "name": "Salesforce account 3"
        }
      },
      "description": "SOQL query for CampaignMembers with Prospecting_Status__c = 'Target Account'"
    },
    {
      "parameters": {
        "jsCode": "// Extract unique companies from CampaignMembers\nconst campaignMembers = $input.item.json.records || [];\n\n// Deduplicate by Account.Id\nconst companiesMap = new Map();\n\nfor (const member of campaignMembers) {\n  const account = member.Account;\n  if (!account || !account.Id) continue;\n  \n  if (!companiesMap.has(account.Id)) {\n    companiesMap.set(account.Id, {\n      salesforce_account_id: account.Id,\n      company_name: account.Name || null,\n      website: account.Website || null\n    });\n  }\n}\n\nconst companies = Array.from(companiesMap.values());\nreturn [{ json: { accounts: companies } }];"
      },
      "id": "extract-companies",
      "name": "Code: Extract Unique Companies",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300],
      "description": "Deduplicates companies by Account.Id, returns { accounts: [...] }"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "options": {}
      },
      "id": "respond-success",
      "name": "Respond: Return Accounts",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1150, 300],
      "description": "Returns { accounts: [{ salesforce_account_id, company_name, website }] } to edge function"
    }
  ],
  "connections": {
    "webhook-campaign-import": {
      "main": [
        [
          {
            "node": "salesforce-query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "salesforce-query": {
      "main": [
        [
          {
            "node": "extract-companies",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "extract-companies": {
      "main": [
        [
          {
            "node": "respond-success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "YNsWb78hzRAhDWLR"
  },
  "tags": ["salesforce", "import"]
}
